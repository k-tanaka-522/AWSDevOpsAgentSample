# T-01 単体試験計画書

## 1. 試験の目的
クラス/メソッド単位での動作検証を行い、ロジックの正当性を担保する。
特にビジネス上のコア価値である「優先度計算ロジック」の精度を保証することを最優先とする。

## 2. 試験対象範囲
| 対象レイヤー | 対象クラス | 重点項目 |使用ツール |
|---|---|---|---|
| Domain Service | `TaskPriorityService` | 計算結果の正確性、境界値テスト、例外系。 | xUnit |
| Repository | `SqliteTaskRepository` | CRUD操作の正常性（インメモリDBまたはテスト用SQLite使用）。 | xUnit + EF Core InMemory |
| ViewModel | `MainWindowViewModel` | プロパティ変更通知、コマンド実行時の状態遷移。 | xUnit |

※ View (XAML) 自体の自動化テストは今回は対象外とする（目視確認）。

## 3. テスト実施環境
- **Framework**: xUnit.net 2.6+
- **Runner**: Visual Studio Test Explorer / `dotnet test` CLI
- **Mocking**: NSubstitute (必要に応じてViewModelテスト等で使用)

## 4. テストケース設計 (方針)

### 4.1 優先度計算ロジック (TaskPriorityServiceTests)
| ID | テスト観点 | 入力値例 | 期待値 |
|---|---|---|---|
| UT-001 | 標準ケース | U=5, I=5, E=1.0 | 17.5 |
| UT-002 | 緊急度最大 | U=10, I=5, E=1.0 | 27.5 |
| UT-003 | 工数最小 (0.1h) | U=5, I=5, E=0.1 | 175.0 |
| UT-004 | 工数0以下 (ガード節) | U=5, I=5, E=0.0 | UT-003と同じ (E=0.1扱い) |
| UT-005 | 期限切れボーナス | 残り -1日 | Base + 20.0 |
| UT-006 | 期限3日以内ボーナス | 残り 3日 | Base + (20 * exp(-0.5*3)) |
| UT-007 | 期限余裕あり | 残り 4日 | Base + 0 |

### 4.2 リポジトリ (SqliteTaskRepositoryTests)
- **Add_AddsTaskToDatabase**: タスクを追加し、Countが1増えることを確認する。
- **GetAll_ReturnsAllTasks**: 複数追加後に全件取得できることを確認する。
- **Update_UpdatesField**: タイトル変更後に再取得し、値が変わっていることを確認する。

## 5. 完了基準
- 全テストケースが Pass すること。
- `TaskPriorityService` のコードカバレッジが 100% であること。
