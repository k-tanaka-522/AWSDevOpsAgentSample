# D-02-01 [共通] 優先度計算ロジック仕様書

## 1. 概要
本アプリのコア機能である「優先度スコア ($P$)」の算出アルゴリズムを定義する。
本ロジックは `TaskPriorityService.Calculate` メソッドとして実装される。

## 2. 計算式詳細
### 2.1 基本式
$$P = \frac{(Urgency \times W_{urgency}) + (Impact \times W_{impact})}{Effort} + Bonus_{date}$$

### 2.2 パラメータ定義
| 変数 | 意味 | 型 | 定義域 | 補正/デフォルト |
|---|---|---|---|---|
| $Urgency$ | 緊急度 | int | 1 〜 10 | ユーザー入力値。 |
| $Impact$ | 影響度 | int | 1 〜 10 | ユーザー入力値。 |
| $Effort$ | 工数(h) | decimal | 0.1 〜 ∞ | 0以下またはnullの場合は **0.1** として計算する（ゼロ除算防止）。 |
| $W_{urgency}$ | 緊急度重み | constant | - | **2.0** (固定) |
| $W_{impact}$ | 影響度重み | constant | - | **1.5** (固定) |

### 2.3 期日ボーナス ($Bonus_{date}$) ロジック
期日が迫ったタスクを強制的に上位に浮上させるためのブースト項。指数関数を用いる。

1. **残り日数 ($Days$)** = $DueDate - Now$ (TotalDays)
   - $DueDate$ が未設定の場合は、Bonus = 0
   - $Days < 0$ (遅延) の場合は、**20.0** ポイント固定加算（最大値）。
2. **閾値**: 残り **3.0日** 以内からボーナス発生。
3. **計算式** (for $0 \le Days \le 3.0$):
   $$Bonus = 20.0 \times e^{-0.5 \times Days}$$

## 3. テストケース（期待値）
| ケース | U | I | E (h) | 残り日数 | 期待スコア (概算) | 備考 |
|---|---|---|---|---|---|---|
| 標準 | 5 | 5 | 1.0 | なし | (10+7.5)/1 = **17.5** | |
| 高緊急 | 10 | 5 | 1.0 | なし | (20+7.5)/1 = **27.5** | |
| コスパ良 | 5 | 5 | 0.5 | なし | 17.5 / 0.5 = **35.0** | 工数が半分ならスコア倍 |
| 期限切迫 | 5 | 5 | 1.0 | 0日 (今日) | 17.5 + 20.0 = **37.5** | ボーナス最大適用 |
| 期限猶予 | 5 | 5 | 1.0 | 3日 | 17.5 + (20*0.22) ≒ **21.9** | ボーナス微増 |
